<!--index.wxml-->
<navigation-bar title="打牌记账" back="{{false}}" color="black" background="#FFF"></navigation-bar>

<scroll-view class="scrollarea" scroll-y type="list">
  <view class="container">
    <!-- 用户信息区域（仅显示，不阻止操作） -->
    <view class="userinfo-card">
      <image class="userinfo-avatar" src="{{userInfo.avatarUrl}}" mode="aspectFill"></image>
      <text class="userinfo-nickname">{{userInfo.nickName || '未登录'}}</text>
    </view>

    <!-- 功能按钮区域（始终显示） -->
    <view class="actions">
      <!-- 开房间按钮 - 单独占一行 -->
      <button class="btn-action btn-primary btn-full" bindtap="createRoom" disabled="{{loading}}">
        <view class="btn-content">
          <text class="btn-icon">🏠</text>
          <text class="btn-text">开房间</text>
          <text class="btn-desc">创建新房间</text>
        </view>
      </button>
      
      <!-- 扫码进入和分享按钮并排 -->
      <view class="btn-row">
        <button class="btn-action btn-secondary" bindtap="scanCode">
          <view class="btn-content">
            <text class="btn-icon">📷</text>
            <text class="btn-text">扫码进入房间</text>
          </view>
        </button>
        
        <button class="btn-action btn-share" open-type="share">
          <view class="btn-content">
            <text class="btn-icon">📤</text>
            <text class="btn-text">分享给好友</text>
            <text class="btn-desc">邀请好友一起玩</text>
          </view>
        </button>
      </view>
      
      <!-- 输入房间号加入房间 -->
      <view class="action-card">
        <view class="card-header">
          <text class="card-title">加入房间</text>
        </view>

        <view class="input-wrapper">
          <input 
            class="room-code-input" 
            type="number"
            placeholder="点击输入房间号，然后点击加入" 
            value="{{roomCodeInput}}"
            bindinput="onRoomCodeInput"
            maxlength="20"
          />
          <button class="btn-join" bindtap="joinRoomByCode" disabled="{{loading || !roomCodeInput}}">
            加入
          </button>
        </view>
      </view>

      <!-- 最近的房间列表 -->
      <recent-rooms
        rooms="{{recentRooms}}"
        userId="{{userId}}"
        bind:roomtap="onRecentRoomTap"
        bind:viewmore="goToRoomList"
      ></recent-rooms>
    </view>
  </view>
</scroll-view>

<!-- 用户信息输入对话框 -->
<t-dialog
  visible="{{showUserDialog}}"
  title="完善用户信息"
  bind:confirm="onDialogConfirm"
  bind:cancel="onDialogClose"
  confirm-btn="{{dialogConfirmBtn}}"
  cancel-btn="取消"
>
  <view slot="content" class="dialog-content">
    <!-- 头像选择区域 -->
    <view class="dialog-avatar-section">
      <text class="dialog-label">选择头像</text>
      <button class="dialog-avatar-btn" open-type="chooseAvatar" bind:chooseavatar="onDialogChooseAvatar">
        <image class="dialog-avatar" src="{{dialogAvatarUrl}}" mode="aspectFill"></image>
        <view class="dialog-avatar-mask">
          <text class="dialog-avatar-icon">📷</text>
        </view>
      </button>
      <text class="dialog-avatar-tip">点击选择头像</text>
    </view>
    
    <!-- 昵称输入区域 -->
    <view class="dialog-nickname-section">
      <text class="dialog-label">输入昵称</text>
      <view class="dialog-input-wrapper">
        <input
          type="nickname"
          class="dialog-nickname-input"
          value="{{dialogNickName}}"
          placeholder="请输入昵称"
          bind:input="onDialogNickNameInput"
          bind:change="onDialogNickNameInput"
          maxlength="20"
        />
      </view>
    </view>
  </view>
</t-dialog>
